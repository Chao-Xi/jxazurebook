# AZ104 - 原题3

## Topic 5 

### Question #65

You have an Azure subscription that contains the public load balancers shown in the following table.

```
Name   SKU
LB1   Basic
LB2   Standard
```

You plan to create six virtual machines and to load balance requests to the virtual machines. Each load balancer will load balance three virtual
machines.

You need to create the virtual machines for the planned solution.
How should you create the virtual machines? To answer, select the appropriate options in the answer area.


NOTE: Each correct selection is worth one

![Alt Image Text](../images/az104_19_1.png "Body image")

Box 1: be created in the same availability set or virtual machine scale set

**The Basic tier is quite restrictive. A load balancer is restricted to a single availability set, virtual machine scale set, or a single machine.**

**Box 2: be connected to the same virtual network**


The Standard tier can span any virtual machine in a single virtual network, including blends of scale sets, availability sets, and machines


Standard SKU: any virtual machines or virtual machine scale sets in a single virtual network.


Basic SKU: Virtual machines in a single availability set or virtual machine scale set.

### Question #66

You have an on-premises data center and an Azure subscription. The data center contains two VPN devices. 

The subscription contains an Azure virtual network named VNet1. VNet1 contains a gateway subnet.

You need to create a site-to-site VPN. The solution must ensure that if a single instance of an Azure VPN gateway fails, or a single on-premises VPN device fails, the failure will not cause an interruption that is longer than two minutes.

What is the minimum number of public IP addresses, virtual network gateways, and local network gateways required in Azure? To answer, select the appropriate options in the answer area.


![Alt Image Text](../images/az104_19_2.png "Body image")

**Box 1: 2 -**

Two public IP addresses in the on-premises data center, and two public IP addresses in the VNET

![Alt Image Text](../images/az104_19_3.png "Body image")

**Box 2: 2 -**

Every Azure VPN gateway consists of two instances in an active-standby configuration. For any planned maintenance or unplanned disruption that happens to the active instance, the standby instance would take over (failover) automatically, and resume the S2S VPN or VNet-to-VNet
connections.

**Box 3: 2 -**

2 public IP addresses for the Azure virtual network gateways (active and standby). Each virtual network gateway requires a unique public IP address.


2 Azure virtual network gateways in the same virtual network (VNet1). **One gateway will be the active gateway, and the other will be the standby gateway.**

2 on-premises VPN devices (routers or VPN appliances). 

Configure two local network gateways in Azure, each representing one on-premises VPN device. **Associate the corresponding local network gateway with the active or standby virtual network gateway**


### Question #67

You have an Azure subscription that contains two virtual machines as shown in the following table

![Alt Image Text](../images/az104_19_4.png "Body image")

**You perform a reverse DNS lookup for 10.0.0.4 from VM2.**

Which FQDN will be returned?

* A. vm1.core.windows.net
* B. vm1.azure.com
* C. vm1.westeurope.cloudapp.azure.com
* **D. vm1.internal.cloudapp.net**

```
testadmin1@VMTEST1:~$ ping -c 5 VMTEST1
PING VMTEST1.qb3monnoaiyubgstehdkra0paa.ax.internal.cloudapp.net (10.0.0.4) 56(84) bytes of data.
64 bytes from vmtest1.internal.cloudapp.net (10.0.0.4): icmp_seq=1 ttl=64 time=0.013 ms
64 bytes from vmtest1.internal.cloudapp.net (10.0.0.4): icmp_seq=2 ttl=64 time=0.042 ms
64 bytes from vmtest1.internal.cloudapp.net (10.0.0.4): icmp_seq=3 ttl=64 time=0.040 ms
64 bytes from vmtest1.internal.cloudapp.net (10.0.0.4): icmp_seq=4 ttl=64 time=0.042 ms
64 bytes from vmtest1.internal.cloudapp.net (10.0.0.4): icmp_seq=5 ttl=64 time=0.044 ms
```

### Question #68

You have an app named App1 that is installed on two Azure virtual machines named VM1 and VM2. Connections to App1 are managed by using
an Azure Load Balancer.

The effective network security configurations for VM2 are shown in the following exhibit.

![Alt Image Text](../images/az104_18_148.png "Body image")

You discover that connections to App1 from 131.107.100.50 over TCP port 443 fail.

You verify that the Load Balancer rules are configured correctly.

You need to ensure that connections to App1 can be established successfully from 131.107.100.50 over TCP port 443.

**Solution: Solution: You create an inbound security rule that allows any traffic from the AzureLoadBalancer source and has a cost of 150**

Does this meet the goal?

**Answer A  Yes**

**The rule with priority 200 blocks all inbound traffic**

That involves the Azure Load Balancer health probe directed to the VM. 

That results in VM2 being considered unhealthy and the LB does not route traffic to it (hence the issue). By placing a rule with the priority 150 that allows them AzureLoadBalancer traffic tag, VM2 is discovered as functional/healthy, the LB directs traffic to it => problem solved.


What is happening here is the LB Health Probe of TCP 443 to VM1 & VM2 are getting blocked by Rule 200 so it thinks both VM1 and VM2 are down. 

Hence App1 is failing as the LB won't direct any 443 traffic anywhere as it considers all Hosts are down.


Make a new rule above 200 or move rule 65001 up to <200, so the Health Probe will start working again, it will find a health host and start to direct 443 traffic from 131.107.100.50 to it.

**App1 is alive!**

### Question #69

You have an Azure subscription that contains a policy-based virtual network gateway named GW1 and a virtual network named VNet1.

**You need to ensure that you can configure a point-to-site connection from an on-premises computer to VNet1.**

Which two actions should you perform? Each correct answer presents part of the solution.


* A. Add a service endpoint to VNet1
* B. Reset GW1
* **C. Create a route-based virtual network gateway**
* D. Add a connection to GW1
* **E. Delete GW1**
* F. Add a public IP address space to VNet1


C: A VPN gateway is used when creating a VPN connection to your on-premises network.

Route-based VPN devices use any-to-any (wildcard) traffic selectors, and let routing/forwarding tables direct traffic to different IPsec tunnels. It is typically built on router platforms where each IPsec tunnel is modeled as a network interface or VTI (virtual tunnel interface).

E: Policy-based VPN devices use the combinations of prefixes from both networks to define how traffic is encrypted/decrypted through IPsec tunnels. It is typically built on firewall devices that perform packet filtering. IPsec tunnel encryption and decryption are added to the packet
filtering and processing 

**Incorrect Answers:**

F: Point-to-Site connections do not require a VPN device or a public-facing IP address.


When you create the virtual network gateway for a VPN gateway configuration, you must specify a VPN type. The VPN type that you choose depends on the connection topology that you want to create. For example, a P2S connection requires a RouteBased VPN type

If you want to use a PolicyBased VPN type, you must use the Basic SKU. PolicyBased VPNs (previously called Static Routing) are not supported on any other SKU. PolicyBased Basic VPN Gateway does not support Point-to-Site connectivity

**The policy type VNG does not support Point to Site VPN .**

You cant have 2 VNG in the same VNET


**So the existing policy-based VNG must be deleted so you can create a route based VPN**

### Question #70

You have an Azure subscription that contains the resources in the following table:

```
Name      Type
VMRG    Resource group
VNetl     Virtual network
VNet2    Virtual network
VMS 	Virtual machine connected to VNetl
VM6	Virtual machine connected to ViNet2
```

In Azure, you create a private DNS zone named adatum.com. You set the registration virtual network to VNet2. 

The adatum.com zone is configured as shown in the following exhibit:

![Alt Image Text](../images/az104_19_5.png "Body image")

For each of the following statements, select Yes if the statement is true. Otherwise, select No.

* The A record for VM5 will be registered automatically in the adatum.com zone.      (No)
* VM5 can resolve VM9.adatum.com.    (No)
* VM6 can resolve VM9.adatum.com.    (Yes)


**Box 1: No -**

Azure DNS provides automatic registration of virtual machines from a single virtual network that's linked to a private zone as a registration
virtual network. VM5 does not belong to the registration virtual network though.

**Box 2: No -**

Forward DNS resolution is supported across virtual networks that are linked to the private zone as resolution virtual networks. VM5 does
belong to a resolution virtual network.

**Box 3: Yes -**

VM6 belongs to registration virtual network, and an A (Host) record exists for VM9 in the DNS zone.

By default, registration virtual networks also act as resolution virtual networks, in the sense that DNS resolution against the zone works from
any of the virtual machines within the registration virtual network.

* VNet1 (NOT A Registration Netvork) : VM5
* VNet2 (IS A Registration Netvork) : VM1, VM6 and VM9

1. VM5 is in VNet1 - answer is NO.
2. VM5 is in VNet1 - answer is NO.
3. VM6 is in VNet2 - answer is YES

### Question #71

You have an Azure subscription that contains the virtual networks shown in the following table.

![Alt Image Text](../images/az104_19_6.png "Body image")

For each of the following statements, select Yes if the statement is true. Otherwise, select No

* You can enable auto reqistration for Link2.
* You can add a virtual network link for VNET1 to Zone3.com.
* You can add a virtual network link for VNET2 to Zonel.com and enable auto registration.

A virtual network can be linked to private DNS zone as a registration or as a resolution virtual network

**Registration virtual network:**

A private DNS zone can have multiple registration virtual networks. However, every virtual network can only have one registration zone associated with it.

**Resolution virtual network:**

One private DNS zone can have multiple resolution virtual networks and a virtual network can have multiple resolution zones associated to it

**1.Yes**

No registration zone for VNET2.

**2.Yes**

A virtual network can have multiple resolution zones associated to it.

**3.Yes**

No registration zone for VNET2.

1. Y. You can click the checkbox to Enable Auto-Reg. Note: You can do this to any VNET as long as that VNET is not linked to another Zone with Auto-reg ON. So if VNET is in another zone but Auto-reg is OFF, then you can enable Auto-Reg in Only One Zone
2. Y. You can add Vnet1 to Zone3 but make sure Auto Reg is OFF. You cannot add Vnet1 to Zone3 with Auto Reg is ON.
3. Y. You can add Vnet2 to Zone1 and set to Auto Reg ON because VNET2 has no link yet to any zone with Auto Reg ON.

1. YES - you can enable auto registration for link2
2. YES - you can add virtual network link VNET1 to zone3
3. Yes - you can add virtual network link VNET2 to zone1.

### Question #72

**You plan to use an Azure Resource Manager template to deploy a virtual network named VNET1 that will use Azure Bastion.**

How should you complete the template? To answer, select the appropriate options in the answer area

![Alt Image Text](../images/az104_19_7.png "Body image")

* Subnet Name： **AzureBastionSubnet**
* AzureBastionSubnet addresses A subnet within your VNet address space with a /27 subnet mask. For example, 10.1.1.0/27


* Subnet Name | AzureBastionSubnet
* AzureBastionSubnet addresses | A subnet within your VNet address space with a subnet mask /26 or larger
	* For example, 10.1.1.0/26.

	
1. AzureBastionSubnet
2. 10.10.10.0/27

### Question #73

You manage a virtual network named VNet1 that is hosted **in the West US Azure region.**

VNet1 hosts two virtual machines named VM1 and VM2 that run Windows Server.

**You need to inspect all the network traffic from VM1 to VM2 for a period of three hours.**

**Solution: From Azure Network Watcher, you create a packet capture.**

Does this meet the goal?

* **A. Yes**
* B. No

**Correct Answer: A**

Network Watcher variable packet capture allows you to create packet capture sessions to track traffic to and from a virtual machine. Packet
capture helps to diagnose network anomalies both reactively and proactively. Other uses include gathering network statistics, gaining
information on network intrusions, to debug client-server communications and much more.

### Question #74

You need to inspect all the network traffic from VM1 to VM2 for a period of three hours.

**Solution: From Azure Network Watcher, you create a connection monitor.**

We need to inspect all the network traffic "from" VM1 "to" VM2 and not between the 2 VMs

Even if we were using Connection monitor, this one would inspect only network traffic over a specific port.

And for a period of 3 hours, packet capture session time limit default value is 18000 seconds or 5 hours.

**Correct solution: Meets the goal.**

- Solution: **From Azure Network Watcher, you create a packet capture**

**Incorrect solution: Does not meet the goal.**

- Solution: From Azure Monitor, **you create a metric on Network In and Network Out.**
- Solution: From Azure Network Watcher, **you create a connection monitor.**
- Solution: From Performance Monitor, **you create a Data Collector Set (DCS).**


### Question #76

You have an Azure subscription that contains the resources shown in the following table

![Alt Image Text](../images/az104_19_8.png "Body image")

**You need to load balance HTTPS connections to vm1 and vm2 by using lb1.**

Which three actions should you perform in sequence? To answer, move the appropriate actions from the list of actions to the answer area and
arrange them in the correct order

![Alt Image Text](../images/az104_19_9.png "Body image")

* 1) Remove the Public IP addresses. They are basic Public IPs and we're using a Standard Load Balancer which aren't compatible
* 2) Create a backend pool and health probes.
* 3) Create a load balancer rule.

### Question #77

**Solution: From Azure Monitor, you create a metric on Network In and Network Out.**

### Question #78

You have an app named App1 that is installed on two Azure virtual machines named VM1 and VM2. 

Connections to App1 are managed by using an Azure Load Balancer.

The effective network security configurations for VM2 are shown in the following exhibit

![Alt Image Text](../images/az104_18_148.png "Body image")

You discover that connections to App1 from 131.107.100.50 over TCP port 443 fail.

You verify that the Load Balancer rules are configured correctly.

You need to ensure that connections to App1 can be established successfully from 131.107.100.50 over TCP port 443.

**Solution: You create an inbound security rule that denies all traffic from the 131.107.100.50 source and has a priority of 64999.**

Does this meet the goal?

* A. Yes
* **B. No**

When an Azure Load Balancer get created, it will probe backend to detect if the backend service is healthy or not, the probe packet is sent from
source address "AzureLoadBalancer", the IP address of "AzureLoadBalancer" is always 168.63.129.16.

What is happening here is the LB Health Probe of TCP 443 to VM1 & VM2 are getting blocked by Rule 200 so it thinks both VM1 and VM2 are
down. Hence App1 is failing as the LB won't direct any 443 traffic anywhere as it considers all Hosts are down

Make a new rule above 200 or move rule 65001 up to <200, so the Health Probe will start working again, it will find a health host and start to direct 443 traffic from 131.107.100.50 to it. 

App1 is alive!

**as rule 200 will still block port 443.**

### Question #79

You have an Azure subscription that contains two on-premises locations named site1 and site2.

You need to connect site1 and site2 by using an Azure Virtual WAN.

Which four actions should you perform in sequence? To answer, move the appropriate actions from the list of actions to the answer area and
arrange them in the correct order.



![Alt Image Text](../images/az104_19_10.png "Body image")

**Create Virtual WAN > Create Hub > Create VPN Sites > Connect VPN sites to Hub**

* Create a virtual WAN
* Configure virtual hub Basic settings
* Configure site-to-site VPN gateway settings
* Create a site
* Connect a site to a virtual hub
* Connect a VPN site to a virtual hub

### Question #80

![Alt Image Text](../images/az104_19_11.png "Body image")

For each of the following statements, select Yes if the statement is true. Otherwise, select No

* Server2 resolves host2.contoso.com to 131.107.50.50.
* Server2 resolves host1.contoso.com to 131.107.10.15.
* Server3 resolves host2.contoso.com to 131.107.50.50.

No:    Server2 uses Server1 for DNS. Server1 has no host2.contoso.com record for 131.107.50.50. It would work if VNET1 has a virtual network link to the private zone contoso.com

Yes: Server2 uses Server1 for DNS. Server1 has a host1.contoso.com record for 131.107.10.15

No: Server3 uses 10.10.0.4 as DNS (inherited from VNET2). 10.10.0.4 (Server1) has no record for host2.contoso.com. The virtual network link for the
private zone contoso.com on VNET2 won't be used since the DNS from VNET1 is set on VNET2. VNET1 DNS is not aware of the private zone
contoso.com. It would work if VNET1 had a virtual network link to the private zone contoso.com.

### Question #81

You have a virtual network named VNet1 as shown in the exhibit. (Click the Exhibit tab.)

![Alt Image Text](../images/az104_19_12.png "Body image")

**No devices are connected to VNet1.**

**You plan to peer VNet1 to another virtual network named VNet2. VNet2 has an address space of 10.2.0.0/16.**

You need to create the peering.

What should you do first?

* **A. Modify the address space of VNet1.**
* B. Add a gateway subnet to VNet1.
* C. Create a subnet on VNet1 and VNet2.
* D. Configure a service endpoint on VNet2.

Correct. Modify the address space of VNET1, since it'd be overlapping with the one of VNET2 if you don't

### Question #82

You have the Azure virtual machines shown in the following table

![Alt Image Text](../images/az104_19_13.png "Body image")

**You need to ping VM2 from VM1.**

Which DNS names can you use to ping VM2?

* A. comp2.contoso.com and comp4.contoso.com only
* B. comp1.contoso.com, comp2.contoso.com, comp3.contoso.com, and comp4.contoso.com
* C. comp2.contoso.com only
* D. comp1.contoso.com and comp2.contoso.com only
* E. comp1.contoso.com, comp2.contoso.com, and comp4.contoso.com only